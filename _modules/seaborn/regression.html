<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>seaborn.regression &#8212; abipy 0.6.0.dev documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/my_style.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.6.0.dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          abipy</a>
        <span class="navbar-text navbar-version pull-left"><b>0.6.0.dev</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Getting AbiPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zzbiblio.html">Bibliography</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/index.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery/index.html">AbiPy Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../postprocessing_howto.html">Post-processing How-To</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../workflows/taskmanager.html">TaskManager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflows/manager_examples.html">Manager Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../flow_gallery/index.html">Flow Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../flows_howto.html">Flows How-To</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../coding_guide.html">Coding guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Documenting AbiPy</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Source code for seaborn.regression</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Plotting functions for linear models (broadly construed).&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="k">import</span> <span class="n">dedent</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="k">import</span> <span class="n">distance</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">statsmodels</span>
    <span class="k">assert</span> <span class="n">statsmodels</span>
    <span class="n">_has_statsmodels</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_has_statsmodels</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">from</span> <span class="nn">.external.six</span> <span class="k">import</span> <span class="n">string_types</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">algorithms</span> <span class="k">as</span> <span class="n">algo</span>
<span class="kn">from</span> <span class="nn">.axisgrid</span> <span class="k">import</span> <span class="n">FacetGrid</span><span class="p">,</span> <span class="n">_facet_docs</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lmplot&quot;</span><span class="p">,</span> <span class="s2">&quot;regplot&quot;</span><span class="p">,</span> <span class="s2">&quot;residplot&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">_LinearPlotter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for plotting relational data in tidy format.</span>

<span class="sd">    To get anything useful done you&#39;ll have to inherit from this, but setup</span>
<span class="sd">    code that can be abstracted out should be put here.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">establish_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extract variables from data or use directly.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="c1"># Validate the inputs</span>
        <span class="n">any_strings</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kws</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="k">if</span> <span class="n">any_strings</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must pass `data` if using named variables.&quot;</span><span class="p">)</span>

        <span class="c1"># Set the variables</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kws</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">val</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dropna</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="nb">vars</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove observations with missing data.&quot;&quot;&quot;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">not_na</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">not_na</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>


<span class="k">class</span> <span class="nc">_RegressionPlotter</span><span class="p">(</span><span class="n">_LinearPlotter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plotter for numeric independent variables with regression model.</span>

<span class="sd">    This does the computations and drawing for the `regplot` function, and</span>
<span class="sd">    is thus also used indirectly by `lmplot`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_estimator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">x_ci</span><span class="o">=</span><span class="s2">&quot;ci&quot;</span><span class="p">,</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit_reg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">n_boot</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                 <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">logistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lowess</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">logx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">x_partial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_partial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_jitter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_jitter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># Set member attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_estimator</span> <span class="o">=</span> <span class="n">x_estimator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ci</span> <span class="o">=</span> <span class="n">ci</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_ci</span> <span class="o">=</span> <span class="n">ci</span> <span class="k">if</span> <span class="n">x_ci</span> <span class="o">==</span> <span class="s2">&quot;ci&quot;</span> <span class="k">else</span> <span class="n">x_ci</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_boot</span> <span class="o">=</span> <span class="n">n_boot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scatter</span> <span class="o">=</span> <span class="n">scatter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_reg</span> <span class="o">=</span> <span class="n">fit_reg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logistic</span> <span class="o">=</span> <span class="n">logistic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lowess</span> <span class="o">=</span> <span class="n">lowess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robust</span> <span class="o">=</span> <span class="n">robust</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logx</span> <span class="o">=</span> <span class="n">logx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span> <span class="o">=</span> <span class="n">truncate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_jitter</span> <span class="o">=</span> <span class="n">x_jitter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_jitter</span> <span class="o">=</span> <span class="n">y_jitter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

        <span class="c1"># Validate the regression options:</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">((</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">logistic</span><span class="p">,</span> <span class="n">robust</span><span class="p">,</span> <span class="n">lowess</span><span class="p">,</span> <span class="n">logx</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Mutually exclusive regression options.&quot;</span><span class="p">)</span>

        <span class="c1"># Extract the data vals from the arguments or passed dataframe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">establish_variables</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
                                 <span class="n">x_partial</span><span class="o">=</span><span class="n">x_partial</span><span class="p">,</span> <span class="n">y_partial</span><span class="o">=</span><span class="n">y_partial</span><span class="p">)</span>

        <span class="c1"># Drop null observations</span>
        <span class="k">if</span> <span class="n">dropna</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;x_partial&quot;</span><span class="p">,</span> <span class="s2">&quot;y_partial&quot;</span><span class="p">)</span>

        <span class="c1"># Regress nuisance variables out of the data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_partial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regress_out</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_partial</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_partial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regress_out</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_partial</span><span class="p">)</span>

        <span class="c1"># Possibly bin the predictor variable, which implies a point estimate</span>
        <span class="k">if</span> <span class="n">x_bins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_estimator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span> <span class="k">if</span> <span class="n">x_estimator</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x_estimator</span>
            <span class="n">x_discrete</span><span class="p">,</span> <span class="n">x_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_predictor</span><span class="p">(</span><span class="n">x_bins</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_discrete</span> <span class="o">=</span> <span class="n">x_discrete</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_discrete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="c1"># Save the range of the x variable for the grid later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scatter_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Data where each observation is a point.&quot;&quot;&quot;</span>
        <span class="n">x_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_jitter</span>
        <span class="k">if</span> <span class="n">x_j</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">x_j</span><span class="p">,</span> <span class="n">x_j</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>

        <span class="n">y_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_jitter</span>
        <span class="k">if</span> <span class="n">y_j</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">y_j</span><span class="p">,</span> <span class="n">y_j</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">estimate_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Data with a point estimate and CI for each discrete x value.&quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_discrete</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">points</span><span class="p">,</span> <span class="n">cis</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>

            <span class="c1"># Get the point estimate of the y variable</span>
            <span class="n">_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">x</span> <span class="o">==</span> <span class="n">val</span><span class="p">]</span>
            <span class="n">est</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_estimator</span><span class="p">(</span><span class="n">_y</span><span class="p">)</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>

            <span class="c1"># Compute the confidence interval for this estimate</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ci</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">units</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ci</span> <span class="o">==</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span>
                    <span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">_y</span><span class="p">)</span>
                    <span class="n">_ci</span> <span class="o">=</span> <span class="n">est</span> <span class="o">-</span> <span class="n">sd</span><span class="p">,</span> <span class="n">est</span> <span class="o">+</span> <span class="n">sd</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">x</span> <span class="o">==</span> <span class="n">val</span><span class="p">]</span>
                    <span class="n">boots</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span><span class="n">_y</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x_estimator</span><span class="p">,</span>
                                           <span class="n">n_boot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
                    <span class="n">_ci</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">ci</span><span class="p">(</span><span class="n">boots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ci</span><span class="p">)</span>
                <span class="n">cis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_ci</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">cis</span>

    <span class="k">def</span> <span class="nf">fit_regression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fit the regression model.&quot;&quot;&quot;</span>
        <span class="c1"># Create the grid for the regression</span>
        <span class="k">if</span> <span class="n">grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span><span class="p">:</span>
                <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_range</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">x_range</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci</span>

        <span class="c1"># Fit the regression</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">yhat</span><span class="p">,</span> <span class="n">yhat_boots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_poly</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">logistic</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">statsmodels.genmod.generalized_linear_model</span> <span class="k">import</span> <span class="n">GLM</span>
            <span class="kn">from</span> <span class="nn">statsmodels.genmod.families</span> <span class="k">import</span> <span class="n">Binomial</span>
            <span class="n">yhat</span><span class="p">,</span> <span class="n">yhat_boots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_statsmodels</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">GLM</span><span class="p">,</span>
                                                    <span class="n">family</span><span class="o">=</span><span class="n">Binomial</span><span class="p">())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowess</span><span class="p">:</span>
            <span class="n">ci</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">grid</span><span class="p">,</span> <span class="n">yhat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_lowess</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">robust</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">statsmodels.robust.robust_linear_model</span> <span class="k">import</span> <span class="n">RLM</span>
            <span class="n">yhat</span><span class="p">,</span> <span class="n">yhat_boots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_statsmodels</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">RLM</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">logx</span><span class="p">:</span>
            <span class="n">yhat</span><span class="p">,</span> <span class="n">yhat_boots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_logx</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yhat</span><span class="p">,</span> <span class="n">yhat_boots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_fast</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

        <span class="c1"># Compute the confidence interval at each grid point</span>
        <span class="k">if</span> <span class="n">ci</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">err_bands</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err_bands</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">ci</span><span class="p">(</span><span class="n">yhat_boots</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">grid</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">err_bands</span>

    <span class="k">def</span> <span class="nf">fit_fast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Low-level regression and prediction using linear algebra.&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">reg_func</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">_y</span><span class="p">)</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">)),</span> <span class="n">grid</span><span class="p">]</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">reg_func</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">yhat</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">beta_boots</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">reg_func</span><span class="p">,</span>
                                    <span class="n">n_boot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">yhat_boots</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">beta_boots</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">yhat_boots</span>

    <span class="k">def</span> <span class="nf">fit_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Regression using numpy polyfit for higher-order trends.&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">reg_func</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">order</span><span class="p">),</span> <span class="n">grid</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">reg_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">yhat</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">yhat_boots</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">reg_func</span><span class="p">,</span>
                                    <span class="n">n_boot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">yhat_boots</span>

    <span class="k">def</span> <span class="nf">fit_statsmodels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;More general regression function using statsmodels objects.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">statsmodels.genmod.generalized_linear_model</span> <span class="k">as</span> <span class="nn">glm</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">)),</span> <span class="n">grid</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">reg_func</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">yhat</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">_y</span><span class="p">,</span> <span class="n">_x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">glm</span><span class="o">.</span><span class="n">PerfectSeparationError</span><span class="p">:</span>
                <span class="n">yhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span>
                <span class="n">yhat</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">yhat</span>

        <span class="n">yhat</span> <span class="o">=</span> <span class="n">reg_func</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">yhat</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">yhat_boots</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">reg_func</span><span class="p">,</span>
                                    <span class="n">n_boot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">yhat_boots</span>

    <span class="k">def</span> <span class="nf">fit_lowess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fit a locally-weighted regression, which returns its own grid.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.nonparametric.smoothers_lowess</span> <span class="k">import</span> <span class="n">lowess</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">yhat</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">grid</span><span class="p">,</span> <span class="n">yhat</span>

    <span class="k">def</span> <span class="nf">fit_logx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fit the model in log-space.&quot;&quot;&quot;</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">grid</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">reg_func</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">):</span>
            <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">_x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">_y</span><span class="p">)</span>

        <span class="n">yhat</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">reg_func</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">yhat</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">beta_boots</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">reg_func</span><span class="p">,</span>
                                    <span class="n">n_boot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">yhat_boots</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">beta_boots</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">yhat_boots</span>

    <span class="k">def</span> <span class="nf">bin_predictor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Discretize a predictor by assigning value to closest bin.&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
            <span class="n">percentiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">bins</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">percentiles</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">bins</span><span class="p">)]</span>

        <span class="n">dist</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">bins</span><span class="p">)</span>
        <span class="n">x_binned</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">x_binned</span><span class="p">,</span> <span class="n">bins</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">regress_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Regress b from a keeping a&#39;s original mean.&quot;&quot;&quot;</span>
        <span class="n">a_mean</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">a_mean</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
        <span class="n">a_prime</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a_prime</span> <span class="o">+</span> <span class="n">a_mean</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="p">,</span> <span class="n">line_kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw the full plot.&quot;&quot;&quot;</span>
        <span class="c1"># Insert the plot label into the correct set of keyword arguments</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatter</span><span class="p">:</span>
            <span class="n">scatter_kws</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_kws</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>

        <span class="c1"># Use the current color cycle state as a default</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>

        <span class="c1"># Ensure that color is hex to avoid matplotlib weidness</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">colorConverter</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>

        <span class="c1"># Let color in keyword arguments override overall plot color</span>
        <span class="n">scatter_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">line_kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

        <span class="c1"># Draw the constituent plots</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_reg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">line_kws</span><span class="p">)</span>

        <span class="c1"># Label the axes</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">scatterplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw the data.&quot;&quot;&quot;</span>
        <span class="c1"># Treat the line-based markers specially, explicitly setting larger</span>
        <span class="c1"># linewidth than is provided by the seaborn style defaults.</span>
        <span class="c1"># This would ideally be handled better in matplotlib (i.e., distinguish</span>
        <span class="c1"># between edgewidth for solid glyphs and linewidth for line glyphs</span>
        <span class="c1"># but this should do for now.</span>
        <span class="n">line_markers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_estimator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;marker&quot;</span> <span class="ow">in</span> <span class="n">kws</span> <span class="ow">and</span> <span class="n">kws</span><span class="p">[</span><span class="s2">&quot;marker&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">line_markers</span><span class="p">:</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.markeredgewidth&quot;</span><span class="p">]</span>
            <span class="n">kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;linewidths&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">)</span>

            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatter_data</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># TODO abstraction</span>
            <span class="n">ci_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">kws</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]}</span>
            <span class="n">ci_kws</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.75</span>
            <span class="n">kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

            <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">cis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_data</span>
            <span class="k">if</span> <span class="p">[</span><span class="n">ci</span> <span class="k">for</span> <span class="n">ci</span> <span class="ow">in</span> <span class="n">cis</span> <span class="k">if</span> <span class="n">ci</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">ci</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">cis</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="n">ci</span><span class="p">,</span> <span class="o">**</span><span class="n">ci_kws</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lineplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw the model.&quot;&quot;&quot;</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>

        <span class="c1"># Fit the regression model</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">err_bands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_regression</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="c1"># Get set default aesthetics</span>
        <span class="n">fill_color</span> <span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="n">kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;lw&quot;</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">kws</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="p">)</span>

        <span class="c1"># Draw the regression line and confidence interval</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err_bands</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="o">*</span><span class="n">err_bands</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">fill_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="n">xlim</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>


<span class="n">_regression_docs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>

    <span class="n">model_api</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    There are a number of mutually exclusive options for estimating the</span>
<span class="s2">    regression model. See the :ref:`tutorial &lt;regression_tutorial&gt;` for more</span>
<span class="s2">    information.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">regplot_vs_lmplot</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    The :func:`regplot` and :func:`lmplot` functions are closely related, but</span>
<span class="s2">    the former is an axes-level function while the latter is a figure-level</span>
<span class="s2">    function that combines :func:`regplot` and :class:`FacetGrid`.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">x_estimator</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    x_estimator : callable that maps vector -&gt; scalar, optional</span>
<span class="s2">        Apply this function to each unique value of ``x`` and plot the</span>
<span class="s2">        resulting estimate. This is useful when ``x`` is a discrete variable.</span>
<span class="s2">        If ``x_ci`` is given, this estimate will be bootstrapped and a</span>
<span class="s2">        confidence interval will be drawn.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">x_bins</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    x_bins : int or vector, optional</span>
<span class="s2">        Bin the ``x`` variable into discrete bins and then estimate the central</span>
<span class="s2">        tendency and a confidence interval. This binning only influences how</span>
<span class="s2">        the scatterplot is drawn; the regression is still fit to the original</span>
<span class="s2">        data.  This parameter is interpreted either as the number of</span>
<span class="s2">        evenly-sized (not necessary spaced) bins or the positions of the bin</span>
<span class="s2">        centers. When this parameter is used, it implies that the default of</span>
<span class="s2">        ``x_estimator`` is ``numpy.mean``.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">x_ci</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    x_ci : &quot;ci&quot;, &quot;sd&quot;, int in [0, 100] or None, optional</span>
<span class="s2">        Size of the confidence interval used when plotting a central tendency</span>
<span class="s2">        for discrete values of ``x``. If ``&quot;ci&quot;``, defer to the value of the</span>
<span class="s2">        ``ci`` parameter. If ``&quot;sd&quot;``, skip bootstrapping and show the</span>
<span class="s2">        standard deviation of the observations in each bin.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">scatter</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    scatter : bool, optional</span>
<span class="s2">        If ``True``, draw a scatterplot with the underlying observations (or</span>
<span class="s2">        the ``x_estimator`` values).</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">fit_reg</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    fit_reg : bool, optional</span>
<span class="s2">        If ``True``, estimate and plot a regression model relating the ``x``</span>
<span class="s2">        and ``y`` variables.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">ci</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    ci : int in [0, 100] or None, optional</span>
<span class="s2">        Size of the confidence interval for the regression estimate. This will</span>
<span class="s2">        be drawn using translucent bands around the regression line. The</span>
<span class="s2">        confidence interval is estimated using a bootstrap; for large</span>
<span class="s2">        datasets, it may be advisable to avoid that computation by setting</span>
<span class="s2">        this parameter to None.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">n_boot</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    n_boot : int, optional</span>
<span class="s2">        Number of bootstrap resamples used to estimate the ``ci``. The default</span>
<span class="s2">        value attempts to balance time and stability; you may want to increase</span>
<span class="s2">        this value for &quot;final&quot; versions of plots.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">units</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    units : variable name in ``data``, optional</span>
<span class="s2">        If the ``x`` and ``y`` observations are nested within sampling units,</span>
<span class="s2">        those can be specified here. This will be taken into account when</span>
<span class="s2">        computing the confidence intervals by performing a multilevel bootstrap</span>
<span class="s2">        that resamples both units and observations (within unit). This does not</span>
<span class="s2">        otherwise influence how the regression is estimated or drawn.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">order</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    order : int, optional</span>
<span class="s2">        If ``order`` is greater than 1, use ``numpy.polyfit`` to estimate a</span>
<span class="s2">        polynomial regression.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">logistic</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    logistic : bool, optional</span>
<span class="s2">        If ``True``, assume that ``y`` is a binary variable and use</span>
<span class="s2">        ``statsmodels`` to estimate a logistic regression model. Note that this</span>
<span class="s2">        is substantially more computationally intensive than linear regression,</span>
<span class="s2">        so you may wish to decrease the number of bootstrap resamples</span>
<span class="s2">        (``n_boot``) or set ``ci`` to None.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">lowess</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    lowess : bool, optional</span>
<span class="s2">        If ``True``, use ``statsmodels`` to estimate a nonparametric lowess</span>
<span class="s2">        model (locally weighted linear regression). Note that confidence</span>
<span class="s2">        intervals cannot currently be drawn for this kind of model.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">robust</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    robust : bool, optional</span>
<span class="s2">        If ``True``, use ``statsmodels`` to estimate a robust regression. This</span>
<span class="s2">        will de-weight outliers. Note that this is substantially more</span>
<span class="s2">        computationally intensive than standard linear regression, so you may</span>
<span class="s2">        wish to decrease the number of bootstrap resamples (``n_boot``) or set</span>
<span class="s2">        ``ci`` to None.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">logx</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    logx : bool, optional</span>
<span class="s2">        If ``True``, estimate a linear regression of the form y ~ log(x), but</span>
<span class="s2">        plot the scatterplot and regression model in the input space. Note that</span>
<span class="s2">        ``x`` must be positive for this to work.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">xy_partial</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    {x,y}_partial : strings in ``data`` or matrices</span>
<span class="s2">        Confounding variables to regress out of the ``x`` or ``y`` variables</span>
<span class="s2">        before plotting.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">truncate</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    truncate : bool, optional</span>
<span class="s2">        By default, the regression line is drawn to fill the x axis limits</span>
<span class="s2">        after the scatterplot is drawn. If ``truncate`` is ``True``, it will</span>
<span class="s2">        instead by bounded by the data limits.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">xy_jitter</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    {x,y}_jitter : floats, optional</span>
<span class="s2">        Add uniform random noise of this size to either the ``x`` or ``y``</span>
<span class="s2">        variables. The noise is added to a copy of the data after fitting the</span>
<span class="s2">        regression, and only influences the look of the scatterplot. This can</span>
<span class="s2">        be helpful when plotting variables that take discrete values.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="n">scatter_line_kws</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    {scatter,line}_kws : dictionaries</span>
<span class="s2">        Additional keyword arguments to pass to ``plt.scatter`` and</span>
<span class="s2">        ``plt.plot``.</span><span class="se">\</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span>
    <span class="p">)</span>
<span class="n">_regression_docs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_facet_docs</span><span class="p">)</span>


<div class="viewcode-block" id="lmplot"><a class="viewcode-back" href="../../api/display_api.html#abipy.display.seabornw.lmplot">[docs]</a><span class="k">def</span> <span class="nf">lmplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">col_wrap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_estimator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">x_ci</span><span class="o">=</span><span class="s2">&quot;ci&quot;</span><span class="p">,</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit_reg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">n_boot</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
           <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">logistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lowess</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">logx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">x_partial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_partial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">x_jitter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_jitter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="c1"># Handle deprecations</span>
    <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">size</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The `size` paramter has been renamed to `height`; &quot;</span>
               <span class="s2">&quot;please update your code.&quot;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

    <span class="c1"># Reduce the dataframe to only needed columns</span>
    <span class="n">need_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">x_partial</span><span class="p">,</span> <span class="n">y_partial</span><span class="p">]</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">need_cols</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>

    <span class="c1"># Initialize the grid</span>
    <span class="n">facets</span> <span class="o">=</span> <span class="n">FacetGrid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
                       <span class="n">row_order</span><span class="o">=</span><span class="n">row_order</span><span class="p">,</span> <span class="n">col_order</span><span class="o">=</span><span class="n">col_order</span><span class="p">,</span>
                       <span class="n">hue_order</span><span class="o">=</span><span class="n">hue_order</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span>
                       <span class="n">col_wrap</span><span class="o">=</span><span class="n">col_wrap</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span>
                       <span class="n">legend_out</span><span class="o">=</span><span class="n">legend_out</span><span class="p">)</span>

    <span class="c1"># Add the markers here as FacetGrid has figured out how many levels of the</span>
    <span class="c1"># hue variable are needed and we don&#39;t want to duplicate that process</span>
    <span class="k">if</span> <span class="n">facets</span><span class="o">.</span><span class="n">hue_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_markers</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n_markers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">facets</span><span class="o">.</span><span class="n">hue_names</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="n">markers</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_markers</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n_markers</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;markers must be a singeton or a list of markers &quot;</span>
                          <span class="s2">&quot;for each level of the hue variable&quot;</span><span class="p">))</span>
    <span class="n">facets</span><span class="o">.</span><span class="n">hue_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="n">markers</span><span class="p">}</span>

    <span class="c1"># Hack to set the x limits properly, which needs to happen here</span>
    <span class="c1"># because the extent of the regression estimate is determined</span>
    <span class="c1"># by the limits of the plot</span>
    <span class="k">if</span> <span class="n">sharex</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">facets</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="c1"># Draw the regression plot on each facet</span>
    <span class="n">regplot_kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">x_estimator</span><span class="o">=</span><span class="n">x_estimator</span><span class="p">,</span> <span class="n">x_bins</span><span class="o">=</span><span class="n">x_bins</span><span class="p">,</span> <span class="n">x_ci</span><span class="o">=</span><span class="n">x_ci</span><span class="p">,</span>
        <span class="n">scatter</span><span class="o">=</span><span class="n">scatter</span><span class="p">,</span> <span class="n">fit_reg</span><span class="o">=</span><span class="n">fit_reg</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="n">ci</span><span class="p">,</span> <span class="n">n_boot</span><span class="o">=</span><span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">logistic</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span> <span class="n">lowess</span><span class="o">=</span><span class="n">lowess</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="n">robust</span><span class="p">,</span>
        <span class="n">logx</span><span class="o">=</span><span class="n">logx</span><span class="p">,</span> <span class="n">x_partial</span><span class="o">=</span><span class="n">x_partial</span><span class="p">,</span> <span class="n">y_partial</span><span class="o">=</span><span class="n">y_partial</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="n">truncate</span><span class="p">,</span>
        <span class="n">x_jitter</span><span class="o">=</span><span class="n">x_jitter</span><span class="p">,</span> <span class="n">y_jitter</span><span class="o">=</span><span class="n">y_jitter</span><span class="p">,</span>
        <span class="n">scatter_kws</span><span class="o">=</span><span class="n">scatter_kws</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="n">line_kws</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">facets</span><span class="o">.</span><span class="n">map_dataframe</span><span class="p">(</span><span class="n">regplot</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">regplot_kws</span><span class="p">)</span>

    <span class="c1"># Add a legend</span>
    <span class="k">if</span> <span class="n">legend</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]):</span>
        <span class="n">facets</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">facets</span></div>


<span class="n">lmplot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Plot data and regression model fits across a FacetGrid.</span>

<span class="s2">    This function combines :func:`regplot` and :class:`FacetGrid`. It is</span>
<span class="s2">    intended as a convenient interface to fit regression models across</span>
<span class="s2">    conditional subsets of a dataset.</span>

<span class="s2">    When thinking about how to assign variables to different facets, a general</span>
<span class="s2">    rule is that it makes sense to use ``hue`` for the most important</span>
<span class="s2">    comparison, followed by ``col`` and ``row``. However, always think about</span>
<span class="s2">    your particular dataset and the goals of the visualization you are</span>
<span class="s2">    creating.</span>

<span class="s2">    </span><span class="si">{model_api}</span><span class="s2"></span>

<span class="s2">    The parameters to this function span most of the options in</span>
<span class="s2">    :class:`FacetGrid`, although there may be occasional cases where you will</span>
<span class="s2">    want to use that class and :func:`regplot` directly.</span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    x, y : strings, optional</span>
<span class="s2">        Input variables; these should be column names in ``data``.</span>
<span class="s2">    </span><span class="si">{data}</span><span class="s2"></span>
<span class="s2">    hue, col, row : strings</span>
<span class="s2">        Variables that define subsets of the data, which will be drawn on</span>
<span class="s2">        separate facets in the grid. See the ``*_order`` parameters to control</span>
<span class="s2">        the order of levels of this variable.</span>
<span class="s2">    </span><span class="si">{palette}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{col_wrap}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{height}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{aspect}</span><span class="s2"></span>
<span class="s2">    markers : matplotlib marker code or list of marker codes, optional</span>
<span class="s2">        Markers for the scatterplot. If a list, each marker in the list will be</span>
<span class="s2">        used for each level of the ``hue`` variable.</span>
<span class="s2">    </span><span class="si">{share_xy}</span><span class="s2"></span>
<span class="s2">    {{hue,col,row}}_order : lists, optional</span>
<span class="s2">        Order for the levels of the faceting variables. By default, this will</span>
<span class="s2">        be the order that the levels appear in ``data`` or, if the variables</span>
<span class="s2">        are pandas categoricals, the category order.</span>
<span class="s2">    legend : bool, optional</span>
<span class="s2">        If ``True`` and there is a ``hue`` variable, add a legend.</span>
<span class="s2">    </span><span class="si">{legend_out}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{x_estimator}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{x_bins}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{x_ci}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{scatter}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{fit_reg}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{ci}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{n_boot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{units}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{order}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{logistic}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{lowess}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{robust}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{logx}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{xy_partial}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{truncate}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{xy_jitter}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{scatter_line_kws}</span><span class="s2"></span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    regplot : Plot data and a conditional model fit.</span>
<span class="s2">    FacetGrid : Subplot grid for plotting conditional relationships.</span>
<span class="s2">    pairplot : Combine :func:`regplot` and :class:`PairGrid` (when used with</span>
<span class="s2">               ``kind=&quot;reg&quot;``).</span>

<span class="s2">    Notes</span>
<span class="s2">    -----</span>

<span class="s2">    </span><span class="si">{regplot_vs_lmplot}</span><span class="s2"></span>

<span class="s2">    Examples</span>
<span class="s2">    --------</span>

<span class="s2">    These examples focus on basic regression model plots to exhibit the</span>
<span class="s2">    various faceting options; see the :func:`regplot` docs for demonstrations</span>
<span class="s2">    of the other options for plotting the data and models. There are also</span>
<span class="s2">    other examples for how to manipulate plot using the returned object on</span>
<span class="s2">    the :class:`FacetGrid` docs.</span>

<span class="s2">    Plot a simple linear relationship between two variables:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import seaborn as sns; sns.set(color_codes=True)</span>
<span class="s2">        &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="s2">        &gt;&gt;&gt; g = sns.lmplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips)</span>

<span class="s2">    Condition on a third variable and plot the levels in different colors:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.lmplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, hue=&quot;smoker&quot;, data=tips)</span>

<span class="s2">    Use different markers as well as colors so the plot will reproduce to</span>
<span class="s2">    black-and-white more easily:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.lmplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, hue=&quot;smoker&quot;, data=tips,</span>
<span class="s2">        ...                markers=[&quot;o&quot;, &quot;x&quot;])</span>

<span class="s2">    Use a different color palette:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.lmplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, hue=&quot;smoker&quot;, data=tips,</span>
<span class="s2">        ...                palette=&quot;Set1&quot;)</span>

<span class="s2">    Map ``hue`` levels to colors with a dictionary:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.lmplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, hue=&quot;smoker&quot;, data=tips,</span>
<span class="s2">        ...                palette=dict(Yes=&quot;g&quot;, No=&quot;m&quot;))</span>

<span class="s2">    Plot the levels of the third variable across different columns:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.lmplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, col=&quot;smoker&quot;, data=tips)</span>

<span class="s2">    Change the height and aspect ratio of the facets:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.lmplot(x=&quot;size&quot;, y=&quot;total_bill&quot;, hue=&quot;day&quot;, col=&quot;day&quot;,</span>
<span class="s2">        ...                data=tips, height=6, aspect=.4, x_jitter=.1)</span>

<span class="s2">    Wrap the levels of the column variable into multiple rows:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.lmplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, col=&quot;day&quot;, hue=&quot;day&quot;,</span>
<span class="s2">        ...                data=tips, col_wrap=2, height=3)</span>

<span class="s2">    Condition on two variables to make a full grid:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.lmplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, row=&quot;sex&quot;, col=&quot;time&quot;,</span>
<span class="s2">        ...                data=tips, height=3)</span>

<span class="s2">    Use methods on the returned :class:`FacetGrid` instance to further tweak</span>
<span class="s2">    the plot:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; g = sns.lmplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, row=&quot;sex&quot;, col=&quot;time&quot;,</span>
<span class="s2">        ...                data=tips, height=3)</span>
<span class="s2">        &gt;&gt;&gt; g = (g.set_axis_labels(&quot;Total bill (US Dollars)&quot;, &quot;Tip&quot;)</span>
<span class="s2">        ...       .set(xlim=(0, 60), ylim=(0, 12),</span>
<span class="s2">        ...            xticks=[10, 30, 50], yticks=[2, 6, 10])</span>
<span class="s2">        ...       .fig.subplots_adjust(wspace=.02))</span>



<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_regression_docs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">regplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_estimator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_ci</span><span class="o">=</span><span class="s2">&quot;ci&quot;</span><span class="p">,</span>
            <span class="n">scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit_reg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">n_boot</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">logistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lowess</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">logx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">x_partial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_partial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_jitter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_jitter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">scatter_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">plotter</span> <span class="o">=</span> <span class="n">_RegressionPlotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x_estimator</span><span class="p">,</span> <span class="n">x_bins</span><span class="p">,</span> <span class="n">x_ci</span><span class="p">,</span>
                                 <span class="n">scatter</span><span class="p">,</span> <span class="n">fit_reg</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">n_boot</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span>
                                 <span class="n">order</span><span class="p">,</span> <span class="n">logistic</span><span class="p">,</span> <span class="n">lowess</span><span class="p">,</span> <span class="n">robust</span><span class="p">,</span> <span class="n">logx</span><span class="p">,</span>
                                 <span class="n">x_partial</span><span class="p">,</span> <span class="n">y_partial</span><span class="p">,</span> <span class="n">truncate</span><span class="p">,</span> <span class="n">dropna</span><span class="p">,</span>
                                 <span class="n">x_jitter</span><span class="p">,</span> <span class="n">y_jitter</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">scatter_kws</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">scatter_kws</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">scatter_kws</span><span class="p">)</span>
    <span class="n">scatter_kws</span><span class="p">[</span><span class="s2">&quot;marker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">marker</span>
    <span class="n">line_kws</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">line_kws</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">line_kws</span><span class="p">)</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="p">,</span> <span class="n">line_kws</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="n">regplot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Plot data and a linear regression model fit.</span>

<span class="s2">    </span><span class="si">{model_api}</span><span class="s2"></span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    x, y: string, series, or vector array</span>
<span class="s2">        Input variables. If strings, these should correspond with column names</span>
<span class="s2">        in ``data``. When pandas objects are used, axes will be labeled with</span>
<span class="s2">        the series name.</span>
<span class="s2">    </span><span class="si">{data}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{x_estimator}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{x_bins}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{x_ci}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{scatter}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{fit_reg}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{ci}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{n_boot}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{units}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{order}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{logistic}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{lowess}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{robust}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{logx}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{xy_partial}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{truncate}</span><span class="s2"></span>
<span class="s2">    </span><span class="si">{xy_jitter}</span><span class="s2"></span>
<span class="s2">    label : string</span>
<span class="s2">        Label to apply to ether the scatterplot or regression line (if</span>
<span class="s2">        ``scatter`` is ``False``) for use in a legend.</span>
<span class="s2">    color : matplotlib color</span>
<span class="s2">        Color to apply to all plot elements; will be superseded by colors</span>
<span class="s2">        passed in ``scatter_kws`` or ``line_kws``.</span>
<span class="s2">    marker : matplotlib marker code</span>
<span class="s2">        Marker to use for the scatterplot glyphs.</span>
<span class="s2">    </span><span class="si">{scatter_line_kws}</span><span class="s2"></span>
<span class="s2">    ax : matplotlib Axes, optional</span>
<span class="s2">        Axes object to draw the plot onto, otherwise uses the current Axes.</span>

<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    ax : matplotlib Axes</span>
<span class="s2">        The Axes object containing the plot.</span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    lmplot : Combine :func:`regplot` and :class:`FacetGrid` to plot multiple</span>
<span class="s2">             linear relationships in a dataset.</span>
<span class="s2">    jointplot : Combine :func:`regplot` and :class:`JointGrid` (when used with</span>
<span class="s2">                ``kind=&quot;reg&quot;``).</span>
<span class="s2">    pairplot : Combine :func:`regplot` and :class:`PairGrid` (when used with</span>
<span class="s2">               ``kind=&quot;reg&quot;``).</span>
<span class="s2">    residplot : Plot the residuals of a linear regression model.</span>

<span class="s2">    Notes</span>
<span class="s2">    -----</span>

<span class="s2">    </span><span class="si">{regplot_vs_lmplot}</span><span class="s2"></span>


<span class="s2">    It&#39;s also easy to combine combine :func:`regplot` and :class:`JointGrid` or</span>
<span class="s2">    :class:`PairGrid` through the :func:`jointplot` and :func:`pairplot`</span>
<span class="s2">    functions, although these do not directly accept all of :func:`regplot`&#39;s</span>
<span class="s2">    parameters.</span>

<span class="s2">    Examples</span>
<span class="s2">    --------</span>

<span class="s2">    Plot the relationship between two variables in a DataFrame:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import seaborn as sns; sns.set(color_codes=True)</span>
<span class="s2">        &gt;&gt;&gt; tips = sns.load_dataset(&quot;tips&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.regplot(x=&quot;total_bill&quot;, y=&quot;tip&quot;, data=tips)</span>

<span class="s2">    Plot with two variables defined as numpy arrays; use a different color:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import numpy as np; np.random.seed(8)</span>
<span class="s2">        &gt;&gt;&gt; mean, cov = [4, 6], [(1.5, .7), (.7, 1)]</span>
<span class="s2">        &gt;&gt;&gt; x, y = np.random.multivariate_normal(mean, cov, 80).T</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.regplot(x=x, y=y, color=&quot;g&quot;)</span>

<span class="s2">    Plot with two variables defined as pandas Series; use a different marker:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; import pandas as pd</span>
<span class="s2">        &gt;&gt;&gt; x, y = pd.Series(x, name=&quot;x_var&quot;), pd.Series(y, name=&quot;y_var&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.regplot(x=x, y=y, marker=&quot;+&quot;)</span>

<span class="s2">    Use a 68</span><span class="si">% c</span><span class="s2">onfidence interval, which corresponds with the standard error</span>
<span class="s2">    of the estimate:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.regplot(x=x, y=y, ci=68)</span>

<span class="s2">    Plot with a discrete ``x`` variable and add some jitter:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.regplot(x=&quot;size&quot;, y=&quot;total_bill&quot;, data=tips, x_jitter=.1)</span>

<span class="s2">    Plot with a discrete ``x`` variable showing means and confidence intervals</span>
<span class="s2">    for unique values:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.regplot(x=&quot;size&quot;, y=&quot;total_bill&quot;, data=tips,</span>
<span class="s2">        ...                  x_estimator=np.mean)</span>

<span class="s2">    Plot with a continuous variable divided into discrete bins:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.regplot(x=x, y=y, x_bins=4)</span>

<span class="s2">    Fit a higher-order polynomial regression and truncate the model prediction:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ans = sns.load_dataset(&quot;anscombe&quot;)</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.regplot(x=&quot;x&quot;, y=&quot;y&quot;, data=ans.loc[ans.dataset == &quot;II&quot;],</span>
<span class="s2">        ...                  scatter_kws={{&quot;s&quot;: 80}},</span>
<span class="s2">        ...                  order=2, ci=None, truncate=True)</span>

<span class="s2">    Fit a robust regression and don&#39;t plot a confidence interval:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.regplot(x=&quot;x&quot;, y=&quot;y&quot;, data=ans.loc[ans.dataset == &quot;III&quot;],</span>
<span class="s2">        ...                  scatter_kws={{&quot;s&quot;: 80}},</span>
<span class="s2">        ...                  robust=True, ci=None)</span>

<span class="s2">    Fit a logistic regression; jitter the y variable and use fewer bootstrap</span>
<span class="s2">    iterations:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; tips[&quot;big_tip&quot;] = (tips.tip / tips.total_bill) &gt; .175</span>
<span class="s2">        &gt;&gt;&gt; ax = sns.regplot(x=&quot;total_bill&quot;, y=&quot;big_tip&quot;, data=tips,</span>
<span class="s2">        ...                  logistic=True, n_boot=500, y_jitter=.03)</span>

<span class="s2">    Fit the regression model using log(x) and truncate the model prediction:</span>

<span class="s2">    .. plot::</span>
<span class="s2">        :context: close-figs</span>

<span class="s2">        &gt;&gt;&gt; ax = sns.regplot(x=&quot;size&quot;, y=&quot;total_bill&quot;, data=tips,</span>
<span class="s2">        ...                  x_estimator=np.mean, logx=True, truncate=True)</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_regression_docs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">residplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lowess</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">x_partial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_partial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">scatter_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot the residuals of a linear regression.</span>

<span class="sd">    This function will regress y on x (possibly as a robust or polynomial</span>
<span class="sd">    regression) and then draw a scatterplot of the residuals. You can</span>
<span class="sd">    optionally fit a lowess smoother to the residual plot, which can</span>
<span class="sd">    help in determining if there is structure to the residuals.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : vector or string</span>
<span class="sd">        Data or column name in `data` for the predictor variable.</span>
<span class="sd">    y : vector or string</span>
<span class="sd">        Data or column name in `data` for the response variable.</span>
<span class="sd">    data : DataFrame, optional</span>
<span class="sd">        DataFrame to use if `x` and `y` are column names.</span>
<span class="sd">    lowess : boolean, optional</span>
<span class="sd">        Fit a lowess smoother to the residual scatterplot.</span>
<span class="sd">    {x, y}_partial : matrix or string(s) , optional</span>
<span class="sd">        Matrix with same first dimension as `x`, or column name(s) in `data`.</span>
<span class="sd">        These variables are treated as confounding and are removed from</span>
<span class="sd">        the `x` or `y` variables before plotting.</span>
<span class="sd">    order : int, optional</span>
<span class="sd">        Order of the polynomial to fit when calculating the residuals.</span>
<span class="sd">    robust : boolean, optional</span>
<span class="sd">        Fit a robust linear regression when calculating the residuals.</span>
<span class="sd">    dropna : boolean, optional</span>
<span class="sd">        If True, ignore observations with missing data when fitting and</span>
<span class="sd">        plotting.</span>
<span class="sd">    label : string, optional</span>
<span class="sd">        Label that will be used in any plot legends.</span>
<span class="sd">    color : matplotlib color, optional</span>
<span class="sd">        Color to use for all elements of the plot.</span>
<span class="sd">    {scatter, line}_kws : dictionaries, optional</span>
<span class="sd">        Additional keyword arguments passed to scatter() and plot() for drawing</span>
<span class="sd">        the components of the plot.</span>
<span class="sd">    ax : matplotlib axis, optional</span>
<span class="sd">        Plot into this axis, otherwise grab the current axis or make a new</span>
<span class="sd">        one if not existing.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ax: matplotlib axes</span>
<span class="sd">        Axes with the regression plot.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    regplot : Plot a simple linear regression model.</span>
<span class="sd">    jointplot (with kind=&quot;resid&quot;): Draw a residplot with univariate</span>
<span class="sd">                                   marginal distrbutions.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plotter</span> <span class="o">=</span> <span class="n">_RegressionPlotter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="n">robust</span><span class="p">,</span>
                                 <span class="n">x_partial</span><span class="o">=</span><span class="n">x_partial</span><span class="p">,</span> <span class="n">y_partial</span><span class="o">=</span><span class="n">y_partial</span><span class="p">,</span>
                                 <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="c1"># Calculate the residual from a linear regression</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">fit_regression</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="n">plotter</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">yhat</span>

    <span class="c1"># Set the regression option on the plotter</span>
    <span class="k">if</span> <span class="n">lowess</span><span class="p">:</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">lowess</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">fit_reg</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Plot a horizontal line at 0</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;.2&quot;</span><span class="p">)</span>

    <span class="c1"># Draw the scatterplot</span>
    <span class="n">scatter_kws</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">scatter_kws</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">scatter_kws</span>
    <span class="n">line_kws</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">line_kws</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">line_kws</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="p">,</span> <span class="n">line_kws</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, M. Giantomassi and the AbiPy group.<br/>
      Last updated on Aug 14, 2018.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>